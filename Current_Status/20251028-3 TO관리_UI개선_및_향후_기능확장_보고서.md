# TO ê´€ë¦¬ UI/UX ê°œì„  ë° í–¥í›„ ê¸°ëŠ¥ í™•ì¥ ë³´ê³ ì„œ

**ì‘ì„±ì¼**: 2025-10-28  
**ì‘ì„±ì**: ê°œë°œíŒ€  
**í”„ë¡œì íŠ¸**: ë¬¼ë¥˜ TO ê´€ë¦¬ ì‹œìŠ¤í…œ  
**Phase**: 2-3 ì™„ë£Œ + UI ê°œì„  + Phase 4 ê¸°íš

---

## ğŸ“‹ ëª©ì°¨

1. [ê¸ˆì¼ ì™„ë£Œ ì‘ì—…](#1-ê¸ˆì¼-ì™„ë£Œ-ì‘ì—…)
2. [ì£¼ìš” ê°œì„  ì‚¬í•­](#2-ì£¼ìš”-ê°œì„ -ì‚¬í•­)
3. [í–¥í›„ ê¸°ëŠ¥ í™•ì¥ ê³„íš](#3-í–¥í›„-ê¸°ëŠ¥-í™•ì¥-ê³„íš)
4. [ê¸°ìˆ ì  ê³ ë ¤ì‚¬í•­](#4-ê¸°ìˆ ì -ê³ ë ¤ì‚¬í•­)

---

## 1. ê¸ˆì¼ ì™„ë£Œ ì‘ì—…

### 1.1 ì‹œê°„ í‘œì‹œ ë¬¸ì œ í•´ê²°

**ë¬¸ì œ ìƒí™©**:
- ê·¸ë£¹ TOì™€ ë‹¨ì¼ TOì˜ ì‹œê°„ì´ `~:~ ~ ~:~`ë¡œ í‘œì‹œë˜ëŠ” ë¬¸ì œ ë°œìƒ
- TO ëª©ë¡ í™”ë©´ì—ì„œ ì‹œê°„ ë²”ìœ„ê°€ ì œëŒ€ë¡œ ê³„ì‚°ë˜ì§€ ì•ŠìŒ

**í•´ê²° ë°©ë²•**:
```dart
// lib/screens/admin/admin_to_list_screen.dart
// _loadTOsWithStats() í•¨ìˆ˜ ë‚´ë¶€

// âœ… ë‹¨ì¼ TO ì‹œê°„ ë²”ìœ„ ê³„ì‚° ì¶”ê°€
if (workDetails.isNotEmpty) {
  String? minStart;
  String? maxEnd;
  
  for (var work in workDetails) {
    if (minStart == null || work.startTime.compareTo(minStart) < 0) {
      minStart = work.startTime;
    }
    if (maxEnd == null || work.endTime.compareTo(maxEnd) > 0) {
      maxEnd = work.endTime;
    }
  }
  
  if (minStart != null && maxEnd != null) {
    masterTO.setTimeRange(minStart, maxEnd);
  }
}
```

**ê²°ê³¼**:
- âœ… ê·¸ë£¹ TO: ëª¨ë“  ë‚ ì§œì˜ ì—…ë¬´ ì¤‘ ìµœì†Œ ì‹œì‘ ~ ìµœëŒ€ ì¢…ë£Œ ì‹œê°„ í‘œì‹œ
- âœ… ë‹¨ì¼ TO: ëª¨ë“  ì—…ë¬´ ì¤‘ ìµœì†Œ ì‹œì‘ ~ ìµœëŒ€ ì¢…ë£Œ ì‹œê°„ í‘œì‹œ

---

### 1.2 TO ì œëª© í‘œì‹œ ê°œì„ 

**ë¬¸ì œ ìƒí™©**:
- ê·¸ë£¹ TOì™€ ë‹¨ì¼ TOê°€ ë™ì¼í•œ í˜•ì‹ìœ¼ë¡œ í‘œì‹œë˜ì–´ êµ¬ë¶„ì´ ì–´ë ¤ì›€
- ë‹¨ì¼ TOì˜ ì œëª©ì´ í‘œì‹œë˜ì§€ ì•ŠëŠ” ë¬¸ì œ ë°œìƒ

**í•´ê²° ë°©ë²•**:
- **ê·¸ë£¹ TO**: ì´ˆë¡ìƒ‰ ë°•ìŠ¤ + í´ë” ì•„ì´ì½˜ + ê·¸ë£¹ëª…
- **ë‹¨ì¼ TO**: íŒŒë€ìƒ‰ ë°•ìŠ¤ + ì‘ì—… ì•„ì´ì½˜ + "ë‹¨ì¼ ê³µê³ " + ì œëª©

```dart
// ê·¸ë£¹ TO
if (masterTO.groupName != null) ...[
  Container(
    decoration: BoxDecoration(
      color: Colors.green[50],
      border: Border.all(color: Colors.green[300]!),
    ),
    child: Row(
      children: [
        Icon(Icons.folder_open, color: Colors.green[700]),
        Text(masterTO.groupName!),
      ],
    ),
  ),
],

// ë‹¨ì¼ TO
if (masterTO.groupName == null) ...[
  Container(
    decoration: BoxDecoration(
      color: Colors.blue[50],
      border: Border.all(color: Colors.blue[300]!),
    ),
    child: Row(
      children: [
        Icon(Icons.work_outline, color: Colors.blue[700]),
        Text('ë‹¨ì¼ ê³µê³ '),
      ],
    ),
  ),
  SizedBox(height: 8),
  Text(masterTO.title, style: TextStyle(fontSize: 16, bold)),
],
```

**ê²°ê³¼**:
- âœ… ì‹œê°ì ìœ¼ë¡œ ê·¸ë£¹ TOì™€ ë‹¨ì¼ TOë¥¼ ëª…í™•íˆ êµ¬ë¶„ ê°€ëŠ¥
- âœ… ë‹¨ì¼ TOì˜ ì œëª©ì´ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œë¨

---

### 1.3 ëª¨ë°”ì¼ í„°ì¹˜ ì˜ì—­ ê°œì„ 

**ë¬¸ì œ ìƒí™©**:
- ê´€ë¦¬ ë²„íŠ¼ë“¤(ìˆ˜ì •, ì‚­ì œ, ì—°ê²°, ìƒì„¸ë³´ê¸°)ì´ ë„ˆë¬´ ì‘ì•„ ëª¨ë°”ì¼ì—ì„œ í„°ì¹˜ê°€ ì–´ë ¤ì›€
- ë²„íŠ¼ ê°„ê²©ì´ ì¢ì•„ ì˜¤í„°ì¹˜ ë°œìƒ ê°€ëŠ¥ì„±

**í•´ê²° ë°©ë²•**:
```dart
IconButton(
  icon: const Icon(Icons.edit, size: 18),
  color: Colors.orange[600],
  // âœ… í„°ì¹˜ ì˜ì—­ í™•ì¥
  padding: const EdgeInsets.all(8),
  constraints: const BoxConstraints(minWidth: 40, minHeight: 40),
  onPressed: () {...},
),
const SizedBox(width: 8),  // ê°„ê²© 4 â†’ 8ë¡œ ì¦ê°€
```

**ì ìš© ë²”ìœ„**:
- âœ… ë‹¨ì¼ TO ë²„íŠ¼ (ìˆ˜ì •, ì‚­ì œ, ê·¸ë£¹ ì—°ê²°, ìƒì„¸ë³´ê¸°)
- âœ… ê·¸ë£¹ TO ë²„íŠ¼ (ê·¸ë£¹ëª… ìˆ˜ì •, ì „ì²´ ì‚­ì œ)
- âœ… ê·¸ë£¹ ë‚´ë¶€ TO ì¹´ë“œ ë²„íŠ¼ (ìˆ˜ì •, ì‚­ì œ, ê·¸ë£¹ í•´ì œ, ìƒì„¸ë³´ê¸°)

**ê²°ê³¼**:
- âœ… ìµœì†Œ í„°ì¹˜ ì˜ì—­: 40x40 í”½ì…€ (Google Material Design ê¶Œì¥ ì‚¬í•­)
- âœ… ë²„íŠ¼ ê°„ê²©: 8í”½ì…€ë¡œ ì¦ê°€í•˜ì—¬ ì˜¤í„°ì¹˜ ë°©ì§€

---

### 1.4 ìƒì„¸ë³´ê¸° ì•„ì´ì½˜ ì¶”ê°€ ë° í†µì¼

**ê°œì„  ë‚´ìš©**:

#### A. ë‹¨ì¼ TO ìƒì„¸ë³´ê¸° ì¶”ê°€
```dart
// ë‹¨ì¼ TO ì¹´ë“œì— ì§€ì›ì ê´€ë¦¬ ì•„ì´ì½˜ ì¶”ê°€
IconButton(
  icon: const Icon(Icons.info_outline, size: 18),
  color: Colors.purple[600],
  tooltip: 'ì§€ì›ì ê´€ë¦¬',
  onPressed: () {
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => AdminTODetailScreen(to: masterTO),
      ),
    );
  },
),
```

#### B. ê·¸ë£¹ ë‚´ë¶€ TO ìƒì„¸ë³´ê¸° ì•„ì´ì½˜ í†µì¼
- **ë³€ê²½ ì „**: `Icons.chevron_right` (íšŒìƒ‰ í™”ì‚´í‘œ)
- **ë³€ê²½ í›„**: `Icons.info_outline` (ë³´ë¼ìƒ‰ ì •ë³´ ì•„ì´ì½˜)

**ê²°ê³¼**:
- âœ… ëª¨ë“  ìƒì„¸ë³´ê¸° ì•„ì´ì½˜ì´ ë™ì¼í•œ ë””ìì¸ìœ¼ë¡œ í†µì¼
- âœ… ì‚¬ìš©ì ê²½í—˜ ì¼ê´€ì„± í™•ë³´

---

### 1.5 TO ìƒì„¸ í™”ë©´ ë°°ì§€ ì¶”ê°€

**ì ìš© ìœ„ì¹˜**: `lib/screens/admin/admin_to_detail_screen.dart`

**ê°œì„  ë‚´ìš©**:
```dart
// ê·¸ë£¹ TO
if (widget.to.groupName != null)
  Container(
    decoration: BoxDecoration(
      color: Colors.green[50],
      border: Border.all(color: Colors.green[300]!),
    ),
    child: Row(
      children: [
        Icon(Icons.folder_open, color: Colors.green[700]),
        Text(widget.to.groupName!),
      ],
    ),
  )
// ë‹¨ì¼ TO
else
  Container(
    decoration: BoxDecoration(
      color: Colors.blue[50],
      border: Border.all(color: Colors.blue[300]!),
    ),
    child: Row(
      children: [
        Icon(Icons.work_outline, color: Colors.blue[700]),
        Text('ë‹¨ì¼ ê³µê³ '),
      ],
    ),
  ),
```

**ê²°ê³¼**:
- âœ… TO ìƒì„¸ í™”ë©´ê³¼ ëª©ë¡ í™”ë©´ì˜ ë””ìì¸ ì¼ê´€ì„± í™•ë³´
- âœ… ì‚¬ìš©ìê°€ í˜„ì¬ ë³´ê³  ìˆëŠ” TO íƒ€ì…ì„ ëª…í™•íˆ ì¸ì§€ ê°€ëŠ¥

---

## 2. ì£¼ìš” ê°œì„  ì‚¬í•­

### 2.1 ì‹œê°ì  ê³„ì¸µ êµ¬ì¡° í™•ë¦½

#### Before (ê°œì„  ì „)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ í…ŒìŠ¤íŠ¸1                          â”‚  â† ê·¸ë£¹ê³¼ ë‹¨ì¼ êµ¬ë¶„ ë¶ˆê°€
â”‚ 2025-10-29 (ìˆ˜)  â° ~:~ ~ ~:~   â”‚  â† ì‹œê°„ ë¯¸í‘œì‹œ
â”‚ í™•ì • 0/1ëª…  ëŒ€ê¸° 0ëª…              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### After (ê°œì„  í›„)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¢ í…ŒìŠ¤íŠ¸1                       â”‚
â”‚ ğŸ“ í…ŒìŠ¤íŠ¸ì—°ê²°í•©ë‹ˆë‹¤!  âœï¸ ğŸ—‘ï¸      â”‚  â† ê·¸ë£¹ TO (ì´ˆë¡ ë°°ì§€)
â”‚ ğŸ“… 2025-10-28 (í™”) ì™¸ 2ì¼         â”‚
â”‚ â° 18:00 ~ 22:00                â”‚  â† ì‹œê°„ ëª…í™•íˆ í‘œì‹œ
â”‚ í™•ì • 0/10ëª…  ëŒ€ê¸° 0ëª…             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¢ í…ŒìŠ¤íŠ¸1                       â”‚
â”‚ ğŸ’¼ ë‹¨ì¼ ê³µê³   âœï¸ ğŸ—‘ï¸ ğŸ”— â„¹ï¸         â”‚  â† ë‹¨ì¼ TO (íŒŒë€ ë°°ì§€)
â”‚ í€µë°°ì†¡ í•˜ì‹¤ë¶„ êµ¬í•©ë‹ˆë‹¤!           â”‚  â† ì œëª© í‘œì‹œ
â”‚ ğŸ“… 2025-10-29 (ìˆ˜)               â”‚
â”‚ â° 09:00 ~ 12:00                â”‚  â† ì‹œê°„ ëª…í™•íˆ í‘œì‹œ
â”‚ í™•ì • 0/1ëª…  ëŒ€ê¸° 0ëª…              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ë²„íŠ¼ ë°°ì¹˜ ì¼ê´€ì„±

| TO íƒ€ì… | ë²„íŠ¼ êµ¬ì„± |
|---------|----------|
| **ë‹¨ì¼ TO** | âœï¸ ìˆ˜ì • / ğŸ—‘ï¸ ì‚­ì œ / ğŸ”— ê·¸ë£¹ ì—°ê²° / â„¹ï¸ ì§€ì›ì ê´€ë¦¬ |
| **ê·¸ë£¹ TO (í—¤ë”)** | âœï¸ ê·¸ë£¹ëª… ìˆ˜ì • / ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ |
| **ê·¸ë£¹ ë‚´ë¶€ TO** | âœï¸ ìˆ˜ì • / ğŸ—‘ï¸ ì‚­ì œ / ğŸ”—âŒ ê·¸ë£¹ í•´ì œ / â„¹ï¸ ì§€ì›ì ê´€ë¦¬ |

### 2.3 ìƒ‰ìƒ ì²´ê³„ ì •ë¦½

| ìš”ì†Œ | ìƒ‰ìƒ | ì˜ë¯¸ |
|------|------|------|
| ì‚¬ì—…ì¥ëª… | íŒŒë€ìƒ‰ ë°°ê²½ | ìµœìƒìœ„ ì •ë³´ |
| ê·¸ë£¹ TO | ì´ˆë¡ìƒ‰ ë°°ì§€ | ë¬¶ìŒ ê³µê³  |
| ë‹¨ì¼ TO | íŒŒë€ìƒ‰ ë°°ì§€ | ê°œë³„ ê³µê³  |
| ìˆ˜ì • ë²„íŠ¼ | ì£¼í™©ìƒ‰ | í¸ì§‘ ì‘ì—… |
| ì‚­ì œ ë²„íŠ¼ | ë¹¨ê°„ìƒ‰ | ìœ„í—˜ ì‘ì—… |
| ì—°ê²°/í•´ì œ | íŒŒë€ìƒ‰/ì£¼í™©ìƒ‰ | ì—°ê²° ì‘ì—… |
| ìƒì„¸ë³´ê¸° | ë³´ë¼ìƒ‰ | ì •ë³´ í™•ì¸ |

---

## 3. í–¥í›„ ê¸°ëŠ¥ í™•ì¥ ê³„íš (Phase 4)

### 3.1 TO ìƒíƒœ ê´€ë¦¬ ì‹œìŠ¤í…œ

#### 3.1.1 TO ë§ˆê° ìƒíƒœ êµ¬ë¶„

**ëª©í‘œ**: ì§„í–‰ì¤‘ TOì™€ ë§ˆê°ëœ TOë¥¼ ëª…í™•íˆ êµ¬ë¶„í•˜ì—¬ ê´€ë¦¬

**ë§ˆê° íŒë‹¨ ê¸°ì¤€**:
```dart
enum TOStatus {
  ACTIVE,        // ì§„í–‰ì¤‘
  CLOSED_MANUAL, // ìˆ˜ë™ ë§ˆê°
  CLOSED_TIME,   // ì‹œê°„ ì´ˆê³¼
  CLOSED_FULL,   // ì¸ì› ì¶©ì¡±
}

bool get isClosed {
  // 1. ìˆ˜ë™ ë§ˆê°
  if (isManualClosed) return true;
  
  // 2. ì‹œê°„ ì´ˆê³¼ (ê·¼ë¬´ ì‹œì‘ ì‹œê°„ ì§€ë‚¨)
  final workStartDateTime = DateTime(
    date.year, date.month, date.day,
    int.parse(startTime.split(':')[0]),
    int.parse(startTime.split(':')[1]),
  );
  if (DateTime.now().isAfter(workStartDateTime)) return true;
  
  // 3. ì¸ì› ì¶©ì¡±
  if (totalConfirmed >= totalRequired) return true;
  
  return false;
}
```

#### 3.1.2 UI êµ¬ì¡° (íƒ­ ë°©ì‹)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TO ê´€ë¦¬                    ğŸ”„ ìƒˆë¡œê³ ì¹¨ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“… ë‚ ì§œ ì„ íƒ                         â”‚
â”‚  ğŸ¢ ì‚¬ì—…ì¥ í•„í„°                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ ì§„í–‰ì¤‘ ]  [ ë§ˆê°ë¨ ]              â”‚  â† íƒ­ ì¶”ê°€ (ì „ì²´ íƒ­ ì—†ìŒ)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  TO ëª©ë¡...                          â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**íƒ­ ì„ íƒ ì´ìœ **:
- âœ… **ì§„í–‰ì¤‘/ë§ˆê°** ë‘ ê°€ì§€ë§Œ í•„ìš”
- âœ… ëª…í™•í•œ êµ¬ë¶„ê³¼ ë¹ ë¥¸ ì „í™˜
- âœ… ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜ ì§€ì›
- âœ… ê¸°ë³¸ í™œì„±í™”: "ì§„í–‰ì¤‘" íƒ­

**ì „ì²´ íƒ­ ë¶ˆí•„ìš” ì´ìœ **:
- ì§„í–‰ì¤‘ê³¼ ë§ˆê°ì„ í•¨ê»˜ ë³¼ í•„ìš”ì„±ì´ ë‚®ìŒ
- í•„í„°ê°€ ë³µì¡í•´ì§
- ì‚¬ìš©ì ê²½í—˜ ì €í•˜

### 3.2 TO ë§ˆê° ê´€ë¦¬ ê¸°ëŠ¥

#### 3.2.1 ìˆ˜ë™ ë§ˆê° ê¸°ëŠ¥

**ìœ„ì¹˜**: TO ì¹´ë“œ ë˜ëŠ” ìƒì„¸ í™”ë©´

```dart
// ì§„í–‰ì¤‘ TO â†’ ë§ˆê° ì²˜ë¦¬
IconButton(
  icon: Icon(Icons.lock),
  tooltip: 'TO ë§ˆê°',
  onPressed: () => _closeTOManually(),
)

Future<void> _closeTOManually() async {
  final confirmed = await showDialog(
    context: context,
    builder: (context) => AlertDialog(
      title: Text('TO ë§ˆê°'),
      content: Text(
        'ì´ TOë¥¼ ë§ˆê° ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n'
        'â€¢ ë” ì´ìƒ ì§€ì›ì„ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤\n'
        'â€¢ í™•ì •ëœ ì§€ì›ìëŠ” ìœ ì§€ë©ë‹ˆë‹¤\n'
        'â€¢ ë§ˆê° ì·¨ì†Œë¡œ ì¬ì˜¤í”ˆ ê°€ëŠ¥í•©ë‹ˆë‹¤'
      ),
      actions: [
        TextButton(
          onPressed: () => Navigator.pop(context, false),
          child: Text('ì·¨ì†Œ'),
        ),
        ElevatedButton(
          onPressed: () => Navigator.pop(context, true),
          child: Text('ë§ˆê°'),
        ),
      ],
    ),
  );
  
  if (confirmed == true) {
    await _firestoreService.updateTO(toId, {
      'isManualClosed': true,
      'closedAt': FieldValue.serverTimestamp(),
      'closedBy': currentUserUID,
    });
  }
}
```

#### 3.2.2 ë§ˆê° ì·¨ì†Œ (ì¬ì˜¤í”ˆ) ê¸°ëŠ¥

```dart
// ë§ˆê°ëœ TO â†’ ì¬ì˜¤í”ˆ
IconButton(
  icon: Icon(Icons.lock_open),
  tooltip: 'TO ì¬ì˜¤í”ˆ',
  onPressed: () => _reopenTO(),
)

Future<void> _reopenTO() async {
  final confirmed = await showDialog(
    context: context,
    builder: (context) => AlertDialog(
      title: Text('TO ì¬ì˜¤í”ˆ'),
      content: Text(
        'ì´ TOë¥¼ ë‹¤ì‹œ ì—´ì–´ ì§€ì›ì„ ë°›ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?\n\n'
        'â€¢ ì§€ì›ìê°€ ë‹¤ì‹œ ì§€ì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤\n'
        'â€¢ ê¸°ì¡´ í™•ì • ì§€ì›ìëŠ” ìœ ì§€ë©ë‹ˆë‹¤'
      ),
      actions: [
        TextButton(
          onPressed: () => Navigator.pop(context, false),
          child: Text('ì·¨ì†Œ'),
        ),
        ElevatedButton(
          onPressed: () => Navigator.pop(context, true),
          child: Text('ì¬ì˜¤í”ˆ'),
        ),
      ],
    ),
  );
  
  if (confirmed == true) {
    await _firestoreService.updateTO(toId, {
      'isManualClosed': false,
      'closedAt': null,
      'closedBy': null,
      'reopenedAt': FieldValue.serverTimestamp(),
      'reopenedBy': currentUserUID,
    });
  }
}
```

#### 3.2.3 ë§ˆê° ì‚¬ìœ  í‘œì‹œ

```dart
Widget _buildClosedBadge(TOModel to) {
  String reason = '';
  Color color = Colors.grey;
  
  if (to.isManualClosed) {
    reason = 'ìˆ˜ë™ ë§ˆê°';
    color = Colors.orange;
  } else if (to.isTimeExpired) {
    reason = 'ì‹œê°„ ì´ˆê³¼';
    color = Colors.red;
  } else if (to.isFull) {
    reason = 'ì¸ì› ì¶©ì¡±';
    color = Colors.green;
  }
  
  return Container(
    padding: EdgeInsets.symmetric(horizontal: 8, vertical: 4),
    decoration: BoxDecoration(
      color: color.withOpacity(0.1),
      borderRadius: BorderRadius.circular(12),
      border: Border.all(color: color),
    ),
    child: Row(
      mainAxisSize: MainAxisSize.min,
      children: [
        Icon(Icons.lock, size: 14, color: color),
        SizedBox(width: 4),
        Text(
          reason,
          style: TextStyle(
            fontSize: 12,
            fontWeight: FontWeight.bold,
            color: color,
          ),
        ),
      ],
    ),
  );
}
```

### 3.3 ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ í™•ì¥

#### 3.3.1 TO ëª¨ë¸ í•„ë“œ ì¶”ê°€

```dart
class TOModel {
  // ê¸°ì¡´ í•„ë“œë“¤...
  
  // âœ… ìƒˆë¡œ ì¶”ê°€í•  í•„ë“œ
  final bool isManualClosed;        // ìˆ˜ë™ ë§ˆê° ì—¬ë¶€
  final DateTime? closedAt;         // ë§ˆê° ì‹œê°
  final String? closedBy;           // ë§ˆê° ì²˜ë¦¬ì UID
  final DateTime? reopenedAt;       // ì¬ì˜¤í”ˆ ì‹œê°
  final String? reopenedBy;         // ì¬ì˜¤í”ˆ ì²˜ë¦¬ì UID
  
  // ê³„ì‚° ì†ì„±
  bool get isTimeExpired {
    final workStart = DateTime(
      date.year, date.month, date.day,
      int.parse(startTime.split(':')[0]),
      int.parse(startTime.split(':')[1]),
    );
    return DateTime.now().isAfter(workStart);
  }
  
  bool get isFull => totalConfirmed >= totalRequired;
  
  bool get isClosed {
    return isManualClosed || isTimeExpired || isFull;
  }
  
  String get closedReason {
    if (isManualClosed) return 'ìˆ˜ë™ ë§ˆê°';
    if (isTimeExpired) return 'ì‹œê°„ ì´ˆê³¼';
    if (isFull) return 'ì¸ì› ì¶©ì¡±';
    return '';
  }
}
```

#### 3.3.2 Firestore ì¿¼ë¦¬ ìµœì í™”

```dart
// ì§„í–‰ì¤‘ TO ì¡°íšŒ
Future<List<TOModel>> getActiveTOs() async {
  final now = Timestamp.now();
  
  final snapshot = await _firestore
    .collection('tos')
    .where('isManualClosed', isEqualTo: false)
    .where('date', isGreaterThanOrEqualTo: now)
    .orderBy('date', descending: false)
    .get();
  
  return snapshot.docs
    .map((doc) => TOModel.fromMap(doc.data(), doc.id))
    .where((to) => !to.isFull)  // ì¸ì› ì¶©ì¡±ë˜ì§€ ì•Šì€ ê²ƒë§Œ
    .toList();
}

// ë§ˆê°ëœ TO ì¡°íšŒ
Future<List<TOModel>> getClosedTOs() async {
  final snapshot = await _firestore
    .collection('tos')
    .where('isManualClosed', isEqualTo: true)
    .orderBy('closedAt', descending: true)
    .get();
  
  final manualClosed = snapshot.docs
    .map((doc) => TOModel.fromMap(doc.data(), doc.id))
    .toList();
  
  // ì‹œê°„ ì´ˆê³¼ ë˜ëŠ” ì¸ì› ì¶©ì¡±ëœ TOë„ ì¶”ê°€
  final allTOs = await _firestore.collection('tos').get();
  final autoClosed = allTOs.docs
    .map((doc) => TOModel.fromMap(doc.data(), doc.id))
    .where((to) => !to.isManualClosed && to.isClosed)
    .toList();
  
  return [...manualClosed, ...autoClosed]
    ..sort((a, b) => (b.closedAt ?? b.date).compareTo(a.closedAt ?? a.date));
}
```

### 3.4 UI/UX ì¶”ê°€ ê°œì„  ì‚¬í•­

#### 3.4.1 ì§„í–‰ì¤‘ íƒ­

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ ì§„í–‰ì¤‘ ] [ ë§ˆê°ë¨ ]                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ¢ í…ŒìŠ¤íŠ¸1                       â”‚ â”‚
â”‚ â”‚ ğŸ“ ê¸‰êµ¬! ê¸´ê¸‰ ëª¨ì§‘              â”‚ â”‚
â”‚ â”‚ ğŸ“… 2025-10-29 (ìˆ˜)              â”‚ â”‚
â”‚ â”‚ â° 09:00 ~ 18:00               â”‚ â”‚
â”‚ â”‚ ğŸ“Š í™•ì • 3/10ëª…  ëŒ€ê¸° 5ëª…        â”‚ â”‚  â† ì§„í–‰ ìƒíƒœ ëª…í™•
â”‚ â”‚ âœï¸ ğŸ—‘ï¸ ğŸ”— â„¹ï¸ ğŸ”’                  â”‚ â”‚  â† ë§ˆê° ë²„íŠ¼ ì¶”ê°€
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.4.2 ë§ˆê°ë¨ íƒ­

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ ì§„í–‰ì¤‘ ] [ ë§ˆê°ë¨ ]                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ¢ í…ŒìŠ¤íŠ¸1                       â”‚ â”‚
â”‚ â”‚ ğŸ“ ì™„ë£Œëœ ê³µê³                    â”‚ â”‚
â”‚ â”‚ ğŸ”’ ìˆ˜ë™ ë§ˆê°  ğŸ“… 10-28 ì¢…ë£Œ     â”‚ â”‚  â† ë§ˆê° ì‚¬ìœ  í‘œì‹œ
â”‚ â”‚ ğŸ“Š í™•ì • 10/10ëª… (ì™„ë£Œ)          â”‚ â”‚
â”‚ â”‚ â„¹ï¸ ğŸ”“                           â”‚ â”‚  â† ì¬ì˜¤í”ˆ ë²„íŠ¼
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ¢ ë¬¼ë¥˜ì„¼í„°A                     â”‚ â”‚
â”‚ â”‚ ğŸ’¼ ë‹¨ì¼ ê³µê³                      â”‚ â”‚
â”‚ â”‚ ğŸ”’ ì‹œê°„ ì´ˆê³¼  ğŸ“… 10-27 ì¢…ë£Œ     â”‚ â”‚  â† ìë™ ë§ˆê°
â”‚ â”‚ ğŸ“Š í™•ì • 7/10ëª… (ë¯¸ì¶©ì¡±)         â”‚ â”‚
â”‚ â”‚ â„¹ï¸ ğŸ”“                           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.5 êµ¬í˜„ ìš°ì„ ìˆœìœ„

#### Phase 4-1: ê¸°ë³¸ ë§ˆê° ê¸°ëŠ¥ (1-2ì¼)
1. âœ… TO ëª¨ë¸ì— ë§ˆê° ê´€ë ¨ í•„ë“œ ì¶”ê°€
2. âœ… ì§„í–‰ì¤‘/ë§ˆê° íƒ­ UI êµ¬í˜„
3. âœ… ìˆ˜ë™ ë§ˆê° ê¸°ëŠ¥
4. âœ… ë§ˆê° ì‚¬ìœ  í‘œì‹œ

#### Phase 4-2: ê³ ê¸‰ ê¸°ëŠ¥ (2-3ì¼)
1. âœ… ì¬ì˜¤í”ˆ ê¸°ëŠ¥
2. âœ… ë§ˆê° ì´ë ¥ ê´€ë¦¬
3. âœ… ì•Œë¦¼ ì‹œìŠ¤í…œ (ë§ˆê° ì„ë°•, ì¸ì› ì¶©ì¡±)
4. âœ… í†µê³„ ëŒ€ì‹œë³´ë“œ (ë§ˆê°ë¥ , ì¶©ì¡±ë¥ )

#### Phase 4-3: ìµœì í™” (1ì¼)
1. âœ… Firestore ì¿¼ë¦¬ ìµœì í™”
2. âœ… ì¸ë±ìŠ¤ ì„¤ì •
3. âœ… ìºì‹± ì „ëµ
4. âœ… ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

---

## 4. ê¸°ìˆ ì  ê³ ë ¤ì‚¬í•­

### 4.1 ì„±ëŠ¥ ìµœì í™”

#### 4.1.1 ì¿¼ë¦¬ ìµœì í™”
```dart
// âŒ ë¹„íš¨ìœ¨ì : ëª¨ë“  TOë¥¼ ê°€ì ¸ì™€ì„œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ í•„í„°ë§
final allTOs = await getAllTOs();
final activeTOs = allTOs.where((to) => !to.isClosed).toList();

// âœ… íš¨ìœ¨ì : ì„œë²„ ì‚¬ì´ë“œ í•„í„°ë§ + ë³µí•© ì¸ë±ìŠ¤
final activeTOs = await _firestore
  .collection('tos')
  .where('isManualClosed', isEqualTo: false)
  .where('date', isGreaterThanOrEqualTo: Timestamp.now())
  .get();
```

#### 4.1.2 í•„ìš”í•œ Firestore ì¸ë±ìŠ¤
```
ì»¬ë ‰ì…˜: tos
ì¸ë±ìŠ¤:
1. isManualClosed (ASC) + date (ASC)
2. isManualClosed (ASC) + closedAt (DESC)
3. businessId (ASC) + date (ASC) + isManualClosed (ASC)
```

### 4.2 ì—ëŸ¬ ì²˜ë¦¬

#### 4.2.1 ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì²˜ë¦¬
```dart
try {
  await _closeTOManually();
} on FirebaseException catch (e) {
  if (e.code == 'permission-denied') {
    ToastHelper.showError('ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
  } else if (e.code == 'unavailable') {
    ToastHelper.showError('ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
  } else {
    ToastHelper.showError('TO ë§ˆê°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
  }
}
```

#### 4.2.2 ë™ì‹œì„± ì œì–´
```dart
// ë‚™ê´€ì  ì ê¸ˆ (Optimistic Locking)
Future<bool> closeTOWithVersion(String toId, int currentVersion) async {
  final toRef = _firestore.collection('tos').doc(toId);
  
  return _firestore.runTransaction((transaction) async {
    final snapshot = await transaction.get(toRef);
    final data = snapshot.data()!;
    
    if (data['version'] != currentVersion) {
      throw Exception('TOê°€ ë‹¤ë¥¸ ê³³ì—ì„œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
    
    transaction.update(toRef, {
      'isManualClosed': true,
      'closedAt': FieldValue.serverTimestamp(),
      'version': currentVersion + 1,
    });
    
    return true;
  });
}
```

### 4.3 ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

#### 4.3.1 ë¡œë”© ìƒíƒœ í‘œì‹œ
```dart
// ìŠ¤ì¼ˆë ˆí†¤ UI
Widget _buildSkeletonCard() {
  return Shimmer.fromColors(
    baseColor: Colors.grey[300]!,
    highlightColor: Colors.grey[100]!,
    child: Card(...),
  );
}
```

#### 4.3.2 ë‚™ê´€ì  UI ì—…ë°ì´íŠ¸
```dart
// ì„œë²„ ì‘ë‹µ ì „ì— UI ë¨¼ì € ì—…ë°ì´íŠ¸
setState(() {
  to.isManualClosed = true;
});

try {
  await _firestoreService.closeTo(to.id);
} catch (e) {
  // ì‹¤íŒ¨ ì‹œ ë¡¤ë°±
  setState(() {
    to.isManualClosed = false;
  });
  ToastHelper.showError('ë§ˆê° ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
}
```

### 4.4 ë°ì´í„° ì¼ê´€ì„±

#### 4.4.1 íŠ¸ëœì­ì…˜ ì‚¬ìš©
```dart
Future<void> closeToWithApplications(String toId) async {
  await _firestore.runTransaction((transaction) async {
    // 1. TO ë§ˆê°
    final toRef = _firestore.collection('tos').doc(toId);
    transaction.update(toRef, {
      'isManualClosed': true,
      'closedAt': FieldValue.serverTimestamp(),
    });
    
    // 2. ëŒ€ê¸°ì¤‘ì¸ ì§€ì›ì„œ ìë™ ê±°ì ˆ
    final apps = await _firestore
      .collection('applications')
      .where('toId', isEqualTo: toId)
      .where('status', isEqualTo: 'PENDING')
      .get();
    
    for (var doc in apps.docs) {
      transaction.update(doc.reference, {
        'status': 'REJECTED',
        'rejectedReason': 'TOê°€ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤.',
        'rejectedAt': FieldValue.serverTimestamp(),
      });
    }
  });
}
```

---

## 5. ì˜ˆìƒ íš¨ê³¼

### 5.1 ê´€ë¦¬ì ì¸¡ë©´
- âœ… TO ìƒíƒœë¥¼ ëª…í™•íˆ íŒŒì•… ê°€ëŠ¥
- âœ… ê³¼ê±° ë§ˆê° ê³µê³  ì´ë ¥ ê´€ë¦¬
- âœ… ì§€ì›ì ê´€ë¦¬ íš¨ìœ¨ì„± ì¦ê°€
- âœ… ë¶ˆí•„ìš”í•œ ì§€ì› ë°©ì§€

### 5.2 ì§€ì›ì ì¸¡ë©´
- âœ… ë§ˆê°ëœ TOì— ë¶ˆí•„ìš”í•œ ì§€ì› ë°©ì§€
- âœ… ëª…í™•í•œ ê³µê³  ìƒíƒœ ì¸ì§€
- âœ… ì‹ ë¢°ì„± ìˆëŠ” ì •ë³´ ì œê³µ

### 5.3 ì‹œìŠ¤í…œ ì¸¡ë©´
- âœ… ë°ì´í„° ì •í™•ì„± í–¥ìƒ
- âœ… ì¿¼ë¦¬ ì„±ëŠ¥ ê°œì„ 
- âœ… í™•ì¥ì„± í™•ë³´

---

## 6. ë¦¬ìŠ¤í¬ ë° ëŒ€ì‘ ë°©ì•ˆ

### 6.1 ì˜ˆìƒ ë¦¬ìŠ¤í¬

| ë¦¬ìŠ¤í¬ | ì˜í–¥ë„ | ëŒ€ì‘ ë°©ì•ˆ |
|--------|--------|-----------|
| ìë™ ë§ˆê° ë¡œì§ ì˜¤ë¥˜ | ë†’ìŒ | ì¶©ë¶„í•œ í…ŒìŠ¤íŠ¸ + ìˆ˜ë™ ì¬ì˜¤í”ˆ ê¸°ëŠ¥ |
| Firestore ì¿¼ë¦¬ ë¹„ìš© ì¦ê°€ | ì¤‘ê°„ | ì¸ë±ìŠ¤ ìµœì í™” + ìºì‹± |
| UI ë³µì¡ë„ ì¦ê°€ | ë‚®ìŒ | ê°„ê²°í•œ íƒ­ êµ¬ì¡° ìœ ì§€ |
| ë™ì‹œì„± ë¬¸ì œ | ì¤‘ê°„ | íŠ¸ëœì­ì…˜ + ë‚™ê´€ì  ì ê¸ˆ |

### 6.2 í…ŒìŠ¤íŠ¸ ê³„íš
1. **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**: ë§ˆê° ë¡œì§ ê²€ì¦
2. **í†µí•© í…ŒìŠ¤íŠ¸**: íƒ­ ì „í™˜ ë° í•„í„°ë§
3. **E2E í…ŒìŠ¤íŠ¸**: ì „ì²´ ë§ˆê° í”„ë¡œì„¸ìŠ¤
4. **ì„±ëŠ¥ í…ŒìŠ¤íŠ¸**: ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬

---

## 7. ê²°ë¡ 

### 7.1 ê¸ˆì¼ ë‹¬ì„± ì‚¬í•­
âœ… ì‹œê°„ í‘œì‹œ ë¬¸ì œ ì™„ì „ í•´ê²°  
âœ… ê·¸ë£¹/ë‹¨ì¼ TO ì‹œê°ì  êµ¬ë¶„ ëª…í™•í™”  
âœ… ëª¨ë°”ì¼ í„°ì¹˜ ì˜ì—­ ìµœì í™”  
âœ… ìƒì„¸ë³´ê¸° ì•„ì´ì½˜ í†µì¼  
âœ… TO ìƒì„¸ í™”ë©´ ì¼ê´€ì„± í™•ë³´  

### 7.2 ë‹¤ìŒ ë‹¨ê³„ (Phase 4)
ğŸ¯ ì§„í–‰ì¤‘/ë§ˆê° íƒ­ êµ¬í˜„  
ğŸ¯ TO ë§ˆê° ê´€ë¦¬ ì‹œìŠ¤í…œ  
ğŸ¯ ì¬ì˜¤í”ˆ ê¸°ëŠ¥  
ğŸ¯ ë§ˆê° ì‚¬ìœ  í‘œì‹œ  
ğŸ¯ ì„±ëŠ¥ ìµœì í™”  

### 7.3 ì˜ˆìƒ ì¼ì •
- **Phase 4-1**: 2-3ì¼ (ê¸°ë³¸ ë§ˆê° ê¸°ëŠ¥)
- **Phase 4-2**: 2-3ì¼ (ê³ ê¸‰ ê¸°ëŠ¥)
- **Phase 4-3**: 1ì¼ (ìµœì í™”)
- **ì´ ì˜ˆìƒ**: 5-7ì¼

---

**ë¬¸ì„œ ë²„ì „**: 1.0  
**ìµœì¢… ìˆ˜ì •**: 2025-10-28  
**ë‹¤ìŒ ê²€í† **: Phase 4 ì°©ìˆ˜ ì „
