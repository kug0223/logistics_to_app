<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firestore ì´ˆê¸° ë°ì´í„° ìƒì„±</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      padding: 40px;
      max-width: 800px;
      width: 100%;
    }
    h1 {
      color: #667eea;
      margin-bottom: 10px;
      font-size: 28px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }
    .config-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .config-section h3 {
      color: #333;
      margin-bottom: 15px;
      font-size: 16px;
    }
    .input-group {
      margin-bottom: 15px;
    }
    .input-group label {
      display: block;
      color: #555;
      margin-bottom: 5px;
      font-size: 14px;
      font-weight: 600;
    }
    .input-group input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      font-family: monospace;
    }
    .input-group input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 14px 28px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      transition: transform 0.2s;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }
    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    #status {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      display: none;
    }
    #status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    #status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    #status.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    .log {
      margin-top: 10px;
      font-size: 13px;
      line-height: 1.6;
    }
    .warning {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”¥ Firestore ì´ˆê¸° ë°ì´í„° ìƒì„±ê¸°</h1>
    <p class="subtitle">Firebase ì„¤ì •ë§Œ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤</p>

    <div class="warning">
      âš ï¸ <strong>ì£¼ì˜:</strong> ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ê¸°ì¡´ ë°ì´í„°ë¥¼ ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”!
    </div>

    <div class="config-section">
      <h3>ğŸ“‹ Firebase ì„¤ì • ì •ë³´</h3>
      <p style="color: #666; font-size: 13px; margin-bottom: 15px;">
        Firebase Console â†’ í”„ë¡œì íŠ¸ ì„¤ì • â†’ ì¼ë°˜ â†’ ë‚´ ì•± â†’ Firebase SDK snippet â†’ êµ¬ì„±
      </p>

      <div class="input-group">
        <label>API Key</label>
        <input type="text" id="apiKey" placeholder="AIzaSy...">
      </div>

      <div class="input-group">
        <label>Auth Domain</label>
        <input type="text" id="authDomain" placeholder="your-project.firebaseapp.com">
      </div>

      <div class="input-group">
        <label>Project ID</label>
        <input type="text" id="projectId" placeholder="your-project-id">
      </div>

      <div class="input-group">
        <label>Storage Bucket</label>
        <input type="text" id="storageBucket" placeholder="your-project.appspot.com">
      </div>

      <div class="input-group">
        <label>Messaging Sender ID</label>
        <input type="text" id="messagingSenderId" placeholder="123456789">
      </div>

      <div class="input-group">
        <label>App ID</label>
        <input type="text" id="appId" placeholder="1:123456789:web:abc123">
      </div>
    </div>

    <button class="btn" onclick="initializeData()">ğŸš€ ë°ì´í„° ìƒì„± ì‹œì‘</button>

    <div id="status"></div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, createUserWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getFirestore, collection, doc, setDoc, Timestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    let app, auth, db;

    window.initializeData = async function() {
      const statusDiv = document.getElementById('status');
      const btn = document.querySelector('.btn');
      
      // ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
      const config = {
        apiKey: document.getElementById('apiKey').value.trim(),
        authDomain: document.getElementById('authDomain').value.trim(),
        projectId: document.getElementById('projectId').value.trim(),
        storageBucket: document.getElementById('storageBucket').value.trim(),
        messagingSenderId: document.getElementById('messagingSenderId').value.trim(),
        appId: document.getElementById('appId').value.trim(),
      };

      // ìœ íš¨ì„± ê²€ì‚¬
      if (Object.values(config).some(v => !v)) {
        showStatus('error', 'âš ï¸ ëª¨ë“  ì„¤ì • ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        return;
      }

      btn.disabled = true;
      showStatus('info', 'â³ Firebase ì´ˆê¸°í™” ì¤‘...');

      try {
        // Firebase ì´ˆê¸°í™”
        app = initializeApp(config);
        auth = getAuth(app);
        db = getFirestore(app);

        showStatus('info', 'âœ… Firebase ì´ˆê¸°í™” ì™„ë£Œ<br>ğŸ“ ë°ì´í„° ìƒì„± ì¤‘...<br><div class="log">');

        // 1. ê´€ë¦¬ì ê³„ì • ìƒì„±
        await createAdminAccount();

        // 2. ì¼ë°˜ ì‚¬ìš©ì ê³„ì • ìƒì„±
        await createUserAccount();

        // 3. TO ë°ì´í„° ìƒì„±
        await createTOData();

        showStatus('success', 'ğŸ‰ ëª¨ë“  ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!<br><br><strong>í…ŒìŠ¤íŠ¸ ê³„ì •:</strong><br>ê´€ë¦¬ì: admin@test.com / admin123!@#<br>ì‚¬ìš©ì: user@test.com / user123!@#');

      } catch (error) {
        console.error(error);
        showStatus('error', `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
      } finally {
        btn.disabled = false;
      }
    };

    async function createAdminAccount() {
      const log = document.querySelector('.log');
      
      try {
        // ê´€ë¦¬ì ê³„ì • ìƒì„±
        const adminCred = await createUserWithEmailAndPassword(auth, 'admin@test.com', 'admin123!@#');
        const adminUID = adminCred.user.uid;
        
        log.innerHTML += `âœ… ê´€ë¦¬ì ê³„ì • ìƒì„± (UID: ${adminUID})<br>`;

        // Firestoreì— ì‚¬ìš©ì ì •ë³´ ì €ì¥
        await setDoc(doc(db, 'users', adminUID), {
          uid: adminUID,
          name: 'ê´€ë¦¬ì',
          email: 'admin@test.com',
          isAdmin: true,
          createdAt: Timestamp.now(),
          lastLoginAt: Timestamp.now(),
        });

        log.innerHTML += `âœ… ê´€ë¦¬ì ì •ë³´ Firestore ì €ì¥ ì™„ë£Œ<br>`;
        return adminUID;

      } catch (error) {
        if (error.code === 'auth/email-already-in-use') {
          log.innerHTML += `âš ï¸ ê´€ë¦¬ì ê³„ì •ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤ (ê±´ë„ˆë›°ê¸°)<br>`;
          return null;
        }
        throw error;
      }
    }

    async function createUserAccount() {
      const log = document.querySelector('.log');
      
      try {
        // ì¼ë°˜ ì‚¬ìš©ì ê³„ì • ìƒì„±
        const userCred = await createUserWithEmailAndPassword(auth, 'user@test.com', 'user123!@#');
        const userUID = userCred.user.uid;
        
        log.innerHTML += `âœ… ì¼ë°˜ ì‚¬ìš©ì ê³„ì • ìƒì„± (UID: ${userUID})<br>`;

        // Firestoreì— ì‚¬ìš©ì ì •ë³´ ì €ì¥
        await setDoc(doc(db, 'users', userUID), {
          uid: userUID,
          name: 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì',
          email: 'user@test.com',
          isAdmin: false,
          createdAt: Timestamp.now(),
          lastLoginAt: Timestamp.now(),
        });

        log.innerHTML += `âœ… ì‚¬ìš©ì ì •ë³´ Firestore ì €ì¥ ì™„ë£Œ<br>`;

      } catch (error) {
        if (error.code === 'auth/email-already-in-use') {
          log.innerHTML += `âš ï¸ ì‚¬ìš©ì ê³„ì •ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤ (ê±´ë„ˆë›°ê¸°)<br>`;
        } else {
          throw error;
        }
      }
    }

    async function createTOData() {
      const log = document.querySelector('.log');
      
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      const tomorrow = new Date(today);
      tomorrow.setDate(tomorrow.getDate() + 1);
      
      const dayAfter = new Date(today);
      dayAfter.setDate(dayAfter.getDate() + 2);

      const tosData = [
        // ì†¡íŒŒ - ì˜¤ëŠ˜ ì˜¤ì „
        {
          centerId: 'CENTER_A',
          centerName: 'ì†¡íŒŒ ë¬¼ë¥˜ì„¼í„°',
          date: Timestamp.fromDate(today),
          startTime: '09:00',
          endTime: '18:00',
          requiredCount: 5,
          currentCount: 2,
          workType: 'í”¼í‚¹',
          description: 'ëƒ‰ë™ì°½ê³  í”¼í‚¹ ì‘ì—…',
          creatorUID: 'admin-temp-uid',
          createdAt: Timestamp.now(),
        },
        // ì†¡íŒŒ - ì˜¤ëŠ˜ ì•¼ê°„
        {
          centerId: 'CENTER_A',
          centerName: 'ì†¡íŒŒ ë¬¼ë¥˜ì„¼í„°',
          date: Timestamp.fromDate(today),
          startTime: '18:00',
          endTime: '24:00',
          requiredCount: 3,
          currentCount: 0,
          workType: 'íŒ¨í‚¹',
          description: 'ìƒˆë²½ ë°°ì†¡ ë¬¼ëŸ‰ íŒ¨í‚¹',
          creatorUID: 'admin-temp-uid',
          createdAt: Timestamp.now(),
        },
        // ê°•ë‚¨ - ë‚´ì¼
        {
          centerId: 'CENTER_B',
          centerName: 'ê°•ë‚¨ ë¬¼ë¥˜ì„¼í„°',
          date: Timestamp.fromDate(tomorrow),
          startTime: '08:00',
          endTime: '17:00',
          requiredCount: 10,
          currentCount: 7,
          workType: 'ë°°ì†¡',
          description: 'ê°•ë‚¨/ì„œì´ˆ ì§€ì—­ ë°°ì†¡',
          creatorUID: 'admin-temp-uid',
          createdAt: Timestamp.now(),
        },
        // ì„œì´ˆ - ëª¨ë ˆ
        {
          centerId: 'CENTER_C',
          centerName: 'ì„œì´ˆ ë¬¼ë¥˜ì„¼í„°',
          date: Timestamp.fromDate(dayAfter),
          startTime: '10:00',
          endTime: '19:00',
          requiredCount: 8,
          currentCount: 8,
          workType: 'ë¶„ë¥˜',
          description: 'íƒë°° ë¶„ë¥˜ ì‘ì—… - ë§ˆê°',
          creatorUID: 'admin-temp-uid',
          createdAt: Timestamp.now(),
        },
        // ì†¡íŒŒ - ë‚´ì¼
        {
          centerId: 'CENTER_A',
          centerName: 'ì†¡íŒŒ ë¬¼ë¥˜ì„¼í„°',
          date: Timestamp.fromDate(tomorrow),
          startTime: '14:00',
          endTime: '22:00',
          requiredCount: 6,
          currentCount: 3,
          workType: 'í•˜ì—­',
          description: 'ì»¨í…Œì´ë„ˆ í•˜ì—­ ì‘ì—…',
          creatorUID: 'admin-temp-uid',
          createdAt: Timestamp.now(),
        },
        // ê°•ë‚¨ - ì˜¤ëŠ˜
        {
          centerId: 'CENTER_B',
          centerName: 'ê°•ë‚¨ ë¬¼ë¥˜ì„¼í„°',
          date: Timestamp.fromDate(today),
          startTime: '13:00',
          endTime: '21:00',
          requiredCount: 4,
          currentCount: 1,
          workType: 'ê²€ìˆ˜',
          description: 'ì…ê³  ë¬¼í’ˆ ê²€ìˆ˜',
          creatorUID: 'admin-temp-uid',
          createdAt: Timestamp.now(),
        },
      ];

      for (let i = 0; i < tosData.length; i++) {
        const toData = tosData[i];
        const docRef = doc(collection(db, 'tos'));
        await setDoc(docRef, toData);
        log.innerHTML += `âœ… TO ${i + 1} ìƒì„±: ${toData.centerName} - ${toData.workType}<br>`;
      }

      log.innerHTML += `<br>âœ… ì´ ${tosData.length}ê°œì˜ TO ìƒì„± ì™„ë£Œ!<br>`;
    }

    function showStatus(type, message) {
      const statusDiv = document.getElementById('status');
      statusDiv.className = type;
      statusDiv.innerHTML = message;
      statusDiv.style.display = 'block';
    }
  </script>
</body>
</html>